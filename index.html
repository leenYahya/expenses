<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>مصاريفي</title>
<style>
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#f0f4f8; direction:rtl; }
.container { max-width:700px; margin:2rem auto; background:white; padding:1.5rem; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.1);}
h1 { text-align:center; color:#4CAF50; }
.day-input { display:flex; justify-content:space-between; margin:0.5rem 0; align-items:center; }
input { width:100px; padding:0.3rem; border-radius:5px; border:1px solid #ccc; text-align:center; }
.totals { margin-bottom:1rem; font-size:1.1rem; }
#totalBalance { color: #007BFF; font-weight:bold; }
#surplus { font-weight:bold; }
button { margin-bottom:10px; padding:0.5rem 1rem; background:#4CAF50; color:white; border:none; border-radius:5px; cursor:pointer; }
button:hover { background:#45a049; }
.clear-btn { background:#f44336; }
.clear-btn:hover { background:#e53935; }
</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
  // ======== ضع هنا بيانات مشروعك من Firebase ========
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
</script>

</head>
<body>
<div class="container">
    <h1>مصاريف الشهر</h1>
    
    <!-- المجموع الأول والثاني + زر الحفظ و Clear -->
    <div class="totals">
        <p>المجموع الأول (رصيدك الحالي): <span id="totalBalance">900</span> ريال</p>
        <p>المجموع الثاني (الفائض/العجز): <span id="surplus">0</span> ريال</p>
        <button onclick="saveData()">حفظ البيانات</button>
        <button class="clear-btn" onclick="clearData()">مسح الكل</button>
    </div>

    <div id="daysContainer"></div>
</div>

<script>
const dailyAmount = 30; // المبلغ اليومي
let initialBalance = 900; // الرصيد الابتدائي
const daysContainer = document.getElementById('daysContainer');

// إنشاء 30 خانة للأيام من 27 إلى 26 بدون الشهر
let dayNumber = 27;
for(let i=0;i<30;i++){
    const div = document.createElement('div');
    div.className = 'day-input';
    
    div.innerHTML = `<label>اليوم ${dayNumber}:</label><input type="number" min="0" value="" id="day${i+1}" oninput="calculate()">`;
    daysContainer.appendChild(div);

    dayNumber++;
    if(dayNumber > 31) dayNumber = 1; // بعد 31 يرجع 1
}

// حساب المجموعين
function calculate(){
    let totalBalance = initialBalance;
    let surplus = 0;

    for(let i=1;i<=30;i++){
        const input = document.getElementById(`day${i}`);
        const val = input.value.trim();

        if(val !== ""){
            const spent = parseFloat(val);
            totalBalance -= spent;
            surplus += (dailyAmount - spent);
        }
    }

    document.getElementById('totalBalance').innerText = totalBalance;
    const surplusEl = document.getElementById('surplus');
    surplusEl.innerText = surplus;
    if(surplus > 0) surplusEl.style.color = 'green';
    else if(surplus < 0) surplusEl.style.color = 'red';
    else surplusEl.style.color = 'black';
}

// حفظ البيانات على Firebase
function saveData(){
    let data = {};
    for(let i=1;i<=30;i++){
        const val = document.getElementById(`day${i}`).value.trim();
        if(val !== ""){
            data[`day${i}`] = parseFloat(val);
        }
    }
    db.ref('expenses').set(data)
      .then(()=> alert("تم حفظ البيانات بنجاح!"))
      .catch(err => console.error(err));
}

// مسح كل البيانات محليًا وFirebase
function clearData(){
    if(confirm("هل أنت متأكدة أنك تريدين مسح كل البيانات؟")){
        for(let i=1;i<=30;i++){
            document.getElementById(`day${i}`).value = "";
        }
        calculate();
        db.ref('expenses').remove()
          .then(()=> console.log("تم مسح البيانات من Firebase"))
          .catch(err => console.error(err));
    }
}

// استرجاع البيانات عند تحميل الصفحة
function loadData(){
    db.ref('expenses').once('value').then(snapshot => {
        const data = snapshot.val();
        if(data){
            for(let i=1;i<=30;i++){
                if(data[`day${i}`] !== undefined){
                    document.getElementById(`day${i}`).value = data[`day${i}`];
                }
            }
            calculate();
        }
    });
}

window.onload = loadData;

</script>
</body>
</html>


